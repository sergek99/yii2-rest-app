var $$=$$||{};$$.App=new JS.Class({initialize:function(){this._tabs(),this._initPopupAdd()},_tabs:function(){new $$.Tabs($(".js-tabs"),{})},_initPopupAdd:function(){allPopups=new $$.AddingPopup({})}}),$(function(){new $$.App;var t=$(".big-field");t.on("click",".delete-adress",function(t){t.preventDefault(),$(t.currentTarget).parents(".adress").remove()});var s=$(".js-name-user"),i=$(".js-name-city"),o=$(".js-name-adress");$(".js-select-user").click(function(t){t.preventDefault();var e=$(t.currentTarget),n=e.data("adress").split(";"),a="";$.each(n,function(t,s){a=a+'<p class="adress">'+n[t]+'<span class="icon-cancel delete-adress"></span></p>'}),s.html(e.find(".name-user").text()),i.html(e.data("city")),o.html(a)});{var e=$(".edit-icon"),n=$(".title-adress"),a=$(".new-adress"),p=$(".js-add-adress");$(".popup-helper")}e.click(function(t){t.preventDefault();$(t.currentTarget)}),n.click(function(s){s.preventDefault(),t.toggle(),a.focus()}),a.focus(function(t){a.attr({placeholder:"Новый адрес"}).css({color:"#595959"})}),p.click(function(t){return t.preventDefault(),a.val()?(a.attr({placeholder:"Новый адрес"}).css({color:"#595959"}),o.append('<p class="adress">'+a.val()+'<span class="icon-cancel delete-adress"></span></p>'),void a.val("")):void a.attr({placeholder:"Введите новый адрес"}).css({color:"red"})})}),$$.Popup=new JS.Class({initialize:function(t,s){this.root=t,this.options=s,this.bodyClientHeight=this.options.bodyClientHeight,this._cacheElements(),this._bindEvents()},_cacheElements:function(){this.nodes={},this.nodes.background=this.root.find(".popup-bg"),this.nodes.popups=this.root.find(".popup-item"),this.nodes.loginPopup=this.options.loginPopup,this.nodes.registrationPopup=this.options.registrationPopup,this.nodes.buttonShowPassword=this.nodes.registrationPopup.find(".js-show-password"),this.nodes.validInputLogin=this.nodes.loginPopup.find(".js-valid"),this.nodes.loginSubmit=this.nodes.loginPopup.find(".submit-login"),this.nodes.goPopupRegistration=this.nodes.loginPopup.find(".link-registration"),this.nodes.validInputRegistration=this.nodes.registrationPopup.find(".js-valid"),this.nodes.registrationSubmit=this.nodes.registrationPopup.find(".submit-registration")},_bindEvents:function(){this.nodes.validInputLogin.on("focus",_.bind(function(t){$(t.currentTarget).removeClass("h-error")},this)),this.nodes.loginSubmit.on("click",_.bind(function(t){var s=!1;t.preventDefault();var i=$(t.currentTarget);this.nodes.validInputLogin.removeClass("h-error");var o=i.parents(".js-form").find(".js-valid-text"),e=i.parents(".js-form").find(".js-valid-mail"),n=/^\w+@\w+\.\w{2,4}$/i;if(o.each(function(t,i){var o=$(i);""==o.val()?(o.addClass("h-error"),s=!0):o.removeClass("h-error")}),e.each(function(t,i){var o=$(i);n.test(o.val())&&""!=o.val()?o.removeClass("h-error"):(o.addClass("h-error"),s=!0)}),!s){var a=(i.parents(".js-form").serialize(),i.parents(".js-form")),p=(a.parents(".popup-item").find(".response-text"),a.serialize());$.ajax({type:"POST",data:p,url:"/login",dataType:"json",success:function(t){if("success"==t.status)location.href=t.redirect;else for(var s in t.errors)$(".field-loginform-"+s).find(".help-block").text(t.errors[s])}})}},this)),this.nodes.goPopupRegistration.on("click",_.bind(function(t){t.preventDefault()},this)),this.nodes.buttonShowPassword.on("click",_.bind(function(t){t.preventDefault();var s=$(t.currentTarget),i=s.parents(".item-form").find(".js-valid");"password"==i.attr("type")?(i.attr("type","text"),s.text("скрыть пароль")):"text"==i.attr("type")&&(i.attr("type","password"),s.text("показать пароль"))},this)),this.nodes.validInputRegistration.on("focus",_.bind(function(t){$(t.currentTarget).removeClass("h-error")},this)),this.nodes.registrationSubmit.on("click",_.bind(function(t){self=this;var s=!1;t.preventDefault();var i=$(t.currentTarget);this.nodes.validInputRegistration.removeClass("h-error");var o=i.parents(".js-form").find(".js-valid-text"),e=i.parents(".js-form").find(".js-valid-mail"),n=/^\w+@\w+\.\w{2,4}$/i;if(o.each(function(t,i){var o=$(i);""==o.val()?(o.addClass("h-error"),s=!0):o.removeClass("h-error")}),e.each(function(t,i){var o=$(i);n.test(o.val())&&""!=o.val()?o.removeClass("h-error"):(o.addClass("h-error"),s=!0)}),!s){var a=i.parents(".js-form").serialize(),p=i.parents(".js-form"),d=p.parents(".popup-item").find(".response-text");$.ajax({type:"POST",url:"/api/login",data:a,success:function(t){var s;"login"==t?(s="<p class='mail_ok'>Вы успешно авторизованы</p>",p.hide(),p.parents(".popup-item").find(".close-button-popup").css("display","block"),d.html(s),setTimeout(function(){self.closePopup()},5e3)):s=t}})}},this))},addPopup:function(t){var s=$("html").scrollTop()+30,i=t.outerWidth()/2;this.bodyClientHeight<t.innerHeight()?t.addClass("pos-absolute"):s=(this.bodyClientHeight-t.innerHeight())/2,t.fadeIn(300).css({top:s}).css({marginLeft:-i}),this.nodes.background.fadeIn(300)},movePopup:function(t){var s=$("html").scrollTop()+30,i=t.outerWidth()/2;this.bodyClientHeight<t.innerHeight()?t.addClass("pos-absolute"):s=(this.bodyClientHeight-t.innerHeight())/2,t.css({top:s,marginLeft:-i})},closePopup:function(t){this.nodes.popups.fadeOut(300).removeClass("pos-absolute"),t||this.nodes.background.fadeOut(300)}}),$$.AddingPopup=new JS.Class({initialize:function(t){this.options=t,this._cacheElements(),this._bindEvents(),this._templateDefault()},_cacheElements:function(){this.nodes={},this.nodes.blockPopup=$(".b-popups"),this.nodes.background=this.nodes.blockPopup.find(".popup-bg"),this.nodes.popups=this.nodes.blockPopup.find(".popup-item"),this.nodes.buttonAddPopup=$(".js-add-popup"),this.nodes.body=$("body"),this.nodes.popupCheaper=$(".popup-cheaper"),this.nodes.buttonSwitchBlock=this.nodes.popupCheaper.find(".js-title-switch-wrapper"),this.nodes.hiddenBlock=this.nodes.popupCheaper.find(".js-select-block"),this.options.widthPopup=this.options.widthPopup||800,this.options.heightPopup=this.options.heightPopup||500,this.options.ajaxLoadingType=this.options.ajaxLoadingType||"get",this.options.className=this.options.className||"default-popup",this.options.idName=this.options.idName||"",this.options.newPopup=this.options.newPopup||!1,this.options.ajaxLoadingContent=this.options.ajaxLoadingContent||!1,this.options.addScrollContent=this.options.addScrollContent||"show",this.options.visible=this.options.visible||"hide",this.options.bodyClientHeight=$("html").outerHeight(),this.options.csrf=$('meta[name="csrf-token"]').attr("content"),this.options.heightHiddenBlock=this.nodes.hiddenBlock.height()||135},_bindEvents:function(){this.nodes.buttonAddPopup.on("click",_.bind(function(t){t.preventDefault();var s=$(t.currentTarget).data("popup"),i=$("#"+s);this.showPopup(i)},this)),this.nodes.blockPopup.on("click",".js-close-popup",_.bind(function(t){t.preventDefault(),this.hidePopup()},this))},_templateDefault:function(){this.options.newPopup?this._addNewPopup():this.options.newPopup||"show"!=this.options.visible?"hide"==this.options.visible&&this.hidePopup($("."+this.options.className)):this.showPopup($("."+this.options.className)),$(window).on("resize",_.bind(function(t){this.resizeWindows()},this))},_ajaxLoadingContent:function(t){var s=this;$.ajax({type:this.options.ajaxLoadingType,url:this.options.ajaxLoadingUrl,data:{_csrf:this.options.csrf},beforeSend:function(){t.find(".popup-content").html('<div class="h-loader"></div>')},success:function(i){t.find(".popup-content").text(i),"show"==s.options.addScrollContent?s.addScroll(t.find(".popup-content")):t.find(".popup-content").css({overflow:"hidden"})}})},_addNewPopup:function(){this.options.idName.length&&(this.options.idName=' id="'+this.options.idName+'" '),this.nodes.blockPopup.append('<div class="popup-item '+this.options.className+'" '+this.options.idName+'><div class="close js-close-popup icon-cancel"></div><div class="popup-content"></div></div>');var t=$("."+this.options.className);t.css({width:this.options.widthPopup,height:this.options.heightPopup,padding:"20px 25px"}),this.options.ajaxLoadingContent&&this._ajaxLoadingContent(t),this.showPopup(t)},resizeWindows:function(){var t=$(".popup-item:visible");t.length&&this.showPopup(t,!0)},addScroll:function(t){t.customScrollbar({wheelSpeed:40,swipeSpeed:1,animationSpeed:600,hScroll:!1})},showPopup:function(t,s){s=s||!1,t=t||$("."+this.options.className),s&&(t.removeClass("pos-absolute"),this.nodes.body.removeClass("h-no-scroll"));var i=$("html").scrollTop()+30,o=t.outerWidth()/2;this.options.bodyClientHeight=$("html").outerHeight(),this.options.bodyClientHeight<t.outerHeight()?t.addClass("pos-absolute"):(i=(this.options.bodyClientHeight-t.outerHeight())/2,this.nodes.body.addClass("h-no-scroll")),t.fadeIn(300).css({top:i,marginLeft:-o}),this.nodes.background.fadeIn(300)},hidePopup:function(t){t=t||this.nodes.blockPopup.find(".popup-item"),t.fadeOut(300).removeClass("pos-absolute"),this.nodes.body.removeClass("h-no-scroll"),this.nodes.background.fadeOut(300)},removePopup:function(t){t=t||$("."+this.options.className),this.hidePopup(t),t.remove()}}),$$.Tabs=new JS.Class({initialize:function(t,s){this.root=t,this.options=s,this._cacheElements(),this._bindEvents()},_cacheElements:function(){this.nodes={tabsTitle:this.root.find(".js-tabs-title").find(".js-tab-item"),tabsContent:this.root.find(".js-tabs-content")}},_bindEvents:function(){this.nodes.tabsTitle.on("click",_.bind(function(t){var s=$(t.currentTarget);if(!s.hasClass("active")){var i=s.parents(".js-tabs"),o=s.index();i.find(".js-tabs-title").find(".js-tab-item").removeClass("active"),s.addClass("active"),i.find(".js-tabs-content").find(".js-tab-item").hide().eq(o).show()}},this))}}),$$.Users=new JS.Class({initialize:function(t,s){this.root=t,this.options=s,this._bindEvents()},_bindEvents:function(){$(document).on("click",".user__details",_.bind(function(t){$(t.currentTarget);alert("Не реализовано"),t.preventDefault()},this))}});